{% extends "accounts/base.html" %}

{% block title %}{% if profile.is_conducteur %}Dashboard Conducteur{% elif profile.is_passager %}Dashboard Passager{% elif profile.is_gestionnaire %}Dashboard Gestionnaire{% else %}Dashboard{% endif %} - Transport Intelligent{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Welcome Header -->
    <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
        <h1 class="mb-2 text-2xl font-bold text-gray-900 dark:text-white">
            {% if profile.is_conducteur %}
                <i class="fas fa-car mr-2 text-brand-600"></i>Dashboard Conducteur
            {% elif profile.is_passager %}
                <i class="fas fa-user mr-2 text-brand-600"></i>Dashboard Passager
            {% elif profile.is_gestionnaire %}
                <i class="fas fa-cog mr-2 text-brand-600"></i>Dashboard Gestionnaire Transport
            {% else %}
                <i class="fas fa-dashboard mr-2 text-brand-600"></i>Dashboard
            {% endif %}
        </h1>
        <p class="text-gray-600 dark:text-gray-400">Bienvenue, <strong>{{ user.username }}</strong> !</p>
    </div>

    <!-- Alertes -->
    {% if not fuseki_available %}
    <div class="rounded-lg border border-orange-200 bg-orange-50 p-4 text-sm text-orange-800 dark:border-orange-900 dark:bg-orange-900 dark:text-orange-400">
        <i class="fas fa-exclamation-triangle mr-2"></i> Apache Fuseki n'est pas disponible. Veuillez démarrer le serveur Fuseki pour voir les données RDF.
    </div>
    {% elif sparql_error %}
    <div class="rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-800 dark:border-red-900 dark:bg-red-900 dark:text-red-400">
        <i class="fas fa-times-circle mr-2"></i> Erreur SPARQL: {{ sparql_error }}
    </div>
    {% endif %}

    <!-- Metrics Cards -->
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
        <!-- Card selon le rôle -->
        {% if profile.is_conducteur %}
        <!-- Mes Trajets Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-brand-100 dark:bg-brand-900">
                <i class="fas fa-route text-brand-600 dark:text-brand-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Mes Trajets</span>
                    <h4 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">Gérer mes trajets</h4>
                </div>
            </div>
        </div>

        <!-- Mon Véhicule Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-green-100 dark:bg-green-900">
                <i class="fas fa-car-side text-green-600 dark:text-green-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Mon Véhicule</span>
                    <h4 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">Informations du véhicule</h4>
                </div>
            </div>
        </div>

        <!-- Horaires Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-blue-100 dark:bg-blue-900">
                <i class="fas fa-clock text-blue-600 dark:text-blue-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Horaires</span>
                    <h4 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">Consulter les horaires</h4>
                </div>
            </div>
        </div>

        {% elif profile.is_passager %}
        <!-- Rechercher Trajet Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-brand-100 dark:bg-brand-900">
                <i class="fas fa-search-location text-brand-600 dark:text-brand-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Rechercher un Trajet</span>
                    <h4 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">Trouver le meilleur trajet</h4>
                </div>
            </div>
        </div>

        <!-- Mes Trajets Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-green-100 dark:bg-green-900">
                <i class="fas fa-map-marked-alt text-green-600 dark:text-green-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Mes Trajets</span>
                    <h4 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">Trajets favoris et récents</h4>
                </div>
            </div>
        </div>

        <!-- Carte Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-blue-100 dark:bg-blue-900">
                <i class="fas fa-map text-blue-600 dark:text-blue-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Carte Interactive</span>
                    <h4 class="mt-2 text-xl font-bold text-gray-900 dark:text-white">Voir les stations et bus</h4>
                </div>
            </div>
        </div>

        {% else %}
        <!-- Stations Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-blue-light-100 dark:bg-blue-light-900">
                <i class="fas fa-map-marker-alt text-blue-light-600 dark:text-blue-light-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Stations</span>
                    <h4 class="mt-2 text-2xl font-bold text-gray-900 dark:text-white">
                        {% if stations %}{{ stations|length }}{% else %}0{% endif %}
                    </h4>
                </div>
                {% if stations %}
                <div class="flex items-center rounded-lg bg-success-50 px-2 py-1 text-sm font-medium text-success-600 dark:bg-success-900 dark:text-success-400">
                    <i class="fas fa-arrow-up mr-1"></i>Actif
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Véhicules Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-orange-100 dark:bg-orange-900">
                <i class="fas fa-bus text-orange-600 dark:text-orange-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Véhicules</span>
                    <h4 class="mt-2 text-2xl font-bold text-gray-900 dark:text-white">
                        {% if vehicles %}{{ vehicles|length }}{% else %}0{% endif %}
                    </h4>
                </div>
                {% if vehicles %}
                <div class="flex items-center rounded-lg bg-success-50 px-2 py-1 text-sm font-medium text-success-600 dark:bg-success-900 dark:text-success-400">
                    <i class="fas fa-arrow-up mr-1"></i>Disponible
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Events Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-yellow-100 dark:bg-yellow-900">
                <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Événements</span>
                    <h4 class="mt-2 text-2xl font-bold text-gray-900 dark:text-white">
                        {% if events %}{{ events|length }}{% else %}0{% endif %}
                    </h4>
                </div>
            </div>
        </div>

        <!-- Utilisateurs Card -->
        <div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">
            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-purple-100 dark:bg-purple-900">
                <i class="fas fa-users text-purple-600 dark:text-purple-400" style="font-size: 1.5rem;"></i>
            </div>
            <div class="mt-5 flex items-end justify-between">
                <div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Utilisateurs</span>
                    <h4 class="mt-2 text-2xl font-bold text-gray-900 dark:text-white">{{ user.username }}</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Tableaux de données -->
    {% if fuseki_available and not sparql_error %}
    
    <!-- Stations Table (Gestionnaire uniquement) -->
    {% if profile.is_gestionnaire %}
    {% if stations %}
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
        <div class="border-b border-gray-200 px-6 py-5 dark:border-gray-800">
            <h5 class="text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-map-marker-alt mr-2 text-brand-600"></i>Stations Disponibles ({{ stations|length }})
            </h5>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50 dark:bg-gray-800">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Nom</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Adresse</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Latitude</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Longitude</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Type</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 bg-white dark:divide-gray-800 dark:bg-white/[0.03]">
                    {% for station in stations %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">{{ station.nom|default:"N/A" }}</td>
                        <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400">{{ station.adresse|default:"-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ station.latitude|default:"-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ station.longitude|default:"-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex rounded-full bg-brand-100 px-3 py-1 text-xs font-medium text-brand-800 dark:bg-brand-900 dark:text-brand-400">
                                {{ station.type|default:"Station" }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Véhicules Grid (Gestionnaire ou Conducteur) -->
    {% if vehicles and profile.is_gestionnaire %}
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
        <div class="border-b border-gray-200 px-6 py-5 dark:border-gray-800">
            <h5 class="text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-bus mr-2 text-brand-600"></i>Véhicules Disponibles ({{ vehicles|length }})
            </h5>
        </div>
        <div class="grid grid-cols-1 gap-4 p-6 md:grid-cols-2 lg:grid-cols-3">
            {% for vehicle in vehicles %}
            <div class="rounded-xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-800 dark:bg-gray-900">
                <h6 class="mb-3 font-semibold text-gray-900 dark:text-white">
                    <i class="fas fa-car mr-2 text-brand-600"></i>{{ vehicle.nom|default:"Véhicule" }}
                </h6>
                <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                    <p><strong>Matricule:</strong> {{ vehicle.matricule|default:"-" }}</p>
                    <p><strong>Capacité:</strong> {{ vehicle.capacite|default:"-" }} passagers</p>
                    <p><strong>Vitesse moyenne:</strong> {{ vehicle.vitesseMoyenne|default:"-" }} km/h</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% endif %}

    {% endif %}

    <!-- Profil Info Card -->
    <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
        <div class="border-b border-gray-200 px-6 py-5 dark:border-gray-800">
            <h5 class="text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-info-circle mr-2 text-brand-600"></i>Informations du Profil
            </h5>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-user-circle text-gray-600 dark:text-gray-400" style="font-size: 2rem;"></i>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Rôle</p>
                        <p class="font-semibold text-gray-900 dark:text-white">{{ profile.get_role_display }}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-envelope text-gray-600 dark:text-gray-400" style="font-size: 2rem;"></i>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Email</p>
                        <p class="font-semibold text-gray-900 dark:text-white">{{ user.email|default:"Non renseigné" }}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-phone text-gray-600 dark:text-gray-400" style="font-size: 2rem;"></i>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Téléphone</p>
                        <p class="font-semibold text-gray-900 dark:text-white">{{ profile.telephone|default:"Non renseigné" }}</p>
                    </div>
                </div>
                {% if profile.linked_uri %}
                <div class="flex items-center space-x-3">
                    <i class="fas fa-link text-gray-600 dark:text-gray-400" style="font-size: 2rem;"></i>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">URI RDF</p>
                        <p class="font-semibold text-gray-900 dark:text-white">
                            <a href="{{ profile.linked_uri }}" target="_blank" class="text-brand-600 hover:underline">
                                Voir l'ontologie
                            </a>
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

